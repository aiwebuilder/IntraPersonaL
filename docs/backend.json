{
  "entities": {
    "Topic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Topic",
      "type": "object",
      "description": "Represents a topic that can be selected in the lottery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Topic entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the topic (e.g., Climate Change)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "SpeechAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SpeechAnalysis",
      "type": "object",
      "description": "Stores the analyzed speech data for a given topic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SpeechAnalysis entity."
        },
        "topicId": {
          "type": "string",
          "description": "Reference to Topic. (Relationship: Topic 1:N SpeechAnalysis)"
        },
        "speechText": {
          "type": "string",
          "description": "The transcribed text from the user's speech."
        },
        "analysisResults": {
          "type": "string",
          "description": "The AI analysis results of the speech."
        }
      },
      "required": [
        "id",
        "topicId",
        "speechText",
        "analysisResults"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question generated by AI based on a topic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Question entity."
        },
        "topicId": {
          "type": "string",
          "description": "Reference to Topic. (Relationship: Topic 1:N Question)"
        },
        "questionText": {
          "type": "string",
          "description": "The text of the generated question."
        }
      },
      "required": [
        "id",
        "topicId",
        "questionText"
      ]
    },
    "Answer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Answer",
      "type": "object",
      "description": "Stores a user's answer to a specific question.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Answer entity."
        },
        "questionId": {
          "type": "string",
          "description": "Reference to Question. (Relationship: Question 1:N Answer)"
        },
        "answerText": {
          "type": "string",
          "description": "The text of the user's answer."
        },
        "analysisResults": {
          "type": "string",
          "description": "The AI analysis results of the answer."
        }
      },
      "required": [
        "id",
        "questionId",
        "answerText",
        "analysisResults"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents the comprehensive personality report generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "topicId": {
          "type": "string",
          "description": "Reference to Topic. (Relationship: Topic 1:N Report)"
        },
        "speechAnalysisId": {
          "type": "string",
          "description": "Reference to SpeechAnalysis. (Relationship: SpeechAnalysis 1:N Report)"
        },
        "reportData": {
          "type": "string",
          "description": "The generated report data, potentially in JSON or another structured format."
        }
      },
      "required": [
        "id",
        "topicId",
        "speechAnalysisId",
        "reportData"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/topics/{topicId}",
        "definition": {
          "entityName": "Topic",
          "schema": {
            "$ref": "#/backend/entities/Topic"
          },
          "description": "Stores available topics for lottery selection. Publicly readable.",
          "params": [
            {
              "name": "topicId",
              "description": "Unique identifier for the topic."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/speechAnalyses/{speechAnalysisId}",
        "definition": {
          "entityName": "SpeechAnalysis",
          "schema": {
            "$ref": "#/backend/entities/SpeechAnalysis"
          },
          "description": "Stores user's speech analyses. Path-based ownership ensures only the user can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "speechAnalysisId",
              "description": "Unique identifier for the speech analysis document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores AI generated questions for the user. Path-based ownership ensures only the user can access their questions.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "questionId",
              "description": "Unique identifier for the question document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/answers/{answerId}",
        "definition": {
          "entityName": "Answer",
          "schema": {
            "$ref": "#/backend/entities/Answer"
          },
          "description": "Stores user's answers to AI generated questions. Path-based ownership ensures only the user can access their answers.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "answerId",
              "description": "Unique identifier for the answer document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores AI generated personality reports. Path-based ownership ensures only the user can access their reports.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "reportId",
              "description": "Unique identifier for the report document."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the AURA+ application's core features: topic selection, speech analysis, question generation, and report generation. To ensure security, scalability, and debuggability, the structure adheres to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.\n\nAuthorization Independence is achieved primarily through structural segregation and path-based ownership. Since the application doesn't involve collaborative data or user roles, denormalization is not extensively required beyond the inherent path-based ownership provided by the `/users/{userId}` structure.\n\nThe structure is designed to facilitate secure `list` operations by structuring data into dedicated collections with homogeneous security postures. This avoids the need for complex filtering in rules.\n\n- **/topics**: This collection stores the available topics for the lottery selection. It's globally readable.\n- **/users/{userId}/speechAnalyses/{speechAnalysisId}**: This collection stores the user's speech analysis for a given topic. Path-based ownership ensures only the user can access their own speech analyses.\n- **/users/{userId}/questions/{questionId}**: This collection stores AI generated questions for the user to answer. Path-based ownership ensures only the user can access their own questions.\n- **/users/{userId}/answers/{answerId}**: This collection stores the user's answers to AI generated questions. Path-based ownership ensures only the user can access their own answers.\n- **/users/{userId}/reports/{reportId}**: This collection stores the AI generated personality reports. Path-based ownership ensures only the user can access their own reports.\n"
  }
}